# å˜èªé¸æŠæ©Ÿèƒ½ã¨ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã®è¨­è¨ˆ

## ğŸ¯ æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå˜èªã‚’é¸ã¶æ–¹æ³•ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ãŒæ¨å¥¨ã™ã‚‹æ¨™æº–çš„ãªå˜èªå¸³ï¼ˆã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900ã€çš„ãªã‚‚ã®ï¼‰ã‚’æä¾›ã™ã‚‹æ©Ÿèƒ½ã®è¨­è¨ˆã€‚

---

## 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒwordsã‹ã‚‰å˜èªã‚’é¸ã¶æ–¹æ³•

### ğŸ’¡ æ¤œç´¢ãƒ»é¸æŠæ–¹æ³•ã®é¸æŠè‚¢

#### æ–¹æ³•1: ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: /notebook_add "ä»Šé€±è¦šãˆã‚‹å˜èª" word:abandon
Bot: âœ… å˜èªã€Œabandonã€ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼
```

**å®Ÿè£…:**
- ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã«å˜èªã‚’å…¥åŠ›
- éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ï¼ˆ`word ILIKE '%abandon%'`ï¼‰
- è¤‡æ•°å€™è£œãŒã‚ã‚‹å ´åˆã¯ä¸Šä½5ä»¶ã‚’è¡¨ç¤ºã—ã¦é¸æŠ

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§å®Ÿè£…ãŒç°¡å˜
- âœ… ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§å®Œçµ

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- âŒ å˜èªã®ã‚¹ãƒšãƒ«ã‚’æ­£ç¢ºã«å…¥åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- âŒ 3800èªã‹ã‚‰æ¢ã™ã®ãŒå¤§å¤‰

---

#### æ–¹æ³•2: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ¤œç´¢ï¼ˆSelect Menuï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: /notebook_add "ä»Šé€±è¦šãˆã‚‹å˜èª"
Bot: è¿½åŠ ã™ã‚‹å˜èªã‚’æ¤œç´¢ã—ã¦ãã ã•ã„:
     [æ¤œç´¢æ¬„: "aban..."ã¨å…¥åŠ›]
     
     æ¤œç´¢çµæœ:
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ 1. abandon (æ¨ã¦ã‚‹)     â”‚
     â”‚ 2. abandonment (æ”¾æ£„)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     [1ã‚’é¸æŠ] â†’ âœ… è¿½åŠ å®Œäº†
```

**å®Ÿè£…:**
- Discordã®Select Menuã¾ãŸã¯Autocompleteã‚’ä½¿ç”¨
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ¤œç´¢å€™è£œã‚’è¡¨ç¤º
- é¸æŠã§è¿½åŠ 

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼
- âœ… ã‚¹ãƒšãƒ«ãƒŸã‚¹ãŒæ¸›ã‚‹
- âœ… è¦–è¦šçš„ã«åˆ†ã‹ã‚Šã‚„ã™ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- âŒ å®Ÿè£…ãŒè¤‡é›‘

---

#### æ–¹æ³•3: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆæ¨å¥¨ï¼‰

```
# æ–¹æ³•A: ç›´æ¥å…¥åŠ›ï¼ˆåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆï¼‰
/notebook_add notebook:"ä»Šé€±è¦šãˆã‚‹å˜èª" word:abandon

# æ–¹æ³•B: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆåˆ†ã‹ã‚‰ãªã„å ´åˆï¼‰
/notebook_add notebook:"ä»Šé€±è¦šãˆã‚‹å˜èª"
â†’ Select Menuã§æ¤œç´¢ãƒ»é¸æŠ
```

**å®Ÿè£…:**
- ã¾ãšç›´æ¥å…¥åŠ›ã§è©¦ã™
- è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ¤œç´¢ã«èª˜å°
- Autocompleteã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢

---

### ğŸ” æ¤œç´¢æ©Ÿèƒ½ã®è©³ç´°è¨­è¨ˆ

#### æ¤œç´¢æ–¹æ³•

```python
# éƒ¨åˆ†ä¸€è‡´æ¤œç´¢ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ï¼‰
SELECT word_id, word, jp, level 
FROM words 
WHERE word ILIKE '%query%' OR jp ILIKE '%query%'
ORDER BY 
  CASE WHEN word = query THEN 1
       WHEN word LIKE query || '%' THEN 2
       ELSE 3 END,
  level ASC
LIMIT 20
```

**æ¤œç´¢å¯¾è±¡:**
- è‹±å˜èªï¼ˆ`word`ï¼‰
- æ—¥æœ¬èªè¨³ï¼ˆ`jp`ï¼‰
- ãƒ¬ãƒ™ãƒ«ï¼ˆ`level`ï¼‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯èƒ½

**æ¤œç´¢å„ªå…ˆé †ä½:**
1. å®Œå…¨ä¸€è‡´ï¼ˆ`word = query`ï¼‰
2. å‰æ–¹ä¸€è‡´ï¼ˆ`word LIKE 'query%'`ï¼‰
3. éƒ¨åˆ†ä¸€è‡´ï¼ˆ`word LIKE '%query%'`ï¼‰

---

#### Autocompleteå®Ÿè£…

```python
@notebook_add.autocomplete('word')
async def word_autocomplete(
    interaction: discord.Interaction,
    current: str
) -> list[discord.app_commands.Choice[str]]:
    """å˜èªæ¤œç´¢ã®Autocomplete"""
    if not current or len(current) < 2:
        # 2æ–‡å­—æœªæº€ã¯æ¤œç´¢ã—ãªã„ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰
        return []
    
    db_manager = get_db_manager()
    async with db_manager.acquire() as conn:
        words = await conn.fetch("""
            SELECT word, jp 
            FROM words 
            WHERE word ILIKE $1 || '%' OR jp ILIKE '%' || $1 || '%'
            ORDER BY 
              CASE WHEN word = $1 THEN 1
                   WHEN word LIKE $1 || '%' THEN 2
                   ELSE 3 END,
              level ASC
            LIMIT 25
        """, current)
    
    return [
        discord.app_commands.Choice(
            name=f"{w['word']} ({w['jp']})",
            value=w['word']
        )
        for w in words
    ]
```

---

#### Select Menuå®Ÿè£…ï¼ˆæ¤œç´¢çµæœã®é¸æŠï¼‰

```python
class WordSelectView(discord.ui.View):
    def __init__(self, words: list[dict], notebook_id: int):
        super().__init__(timeout=60.0)
        self.notebook_id = notebook_id
        
        # Select Menuã‚’ä½œæˆ
        options = [
            discord.SelectOption(
                label=f"{w['word']}",
                description=w['jp'][:100],
                value=str(w['word_id']),
                emoji="ğŸ“"
            )
            for w in words[:25]  # Discordã®åˆ¶é™
        ]
        
        self.add_item(discord.ui.Select(
            placeholder="è¿½åŠ ã™ã‚‹å˜èªã‚’é¸æŠ...",
            options=options,
            custom_id="word_select"
        ))
    
    @discord.ui.select(custom_id="word_select")
    async def word_select_callback(
        self, interaction: discord.Interaction, select: discord.ui.Select
    ):
        word_id = int(select.values[0])
        # å˜èªå¸³ã«è¿½åŠ 
        # ...
```

---

### ğŸ“ å®Ÿè£…ä¾‹: æ¤œç´¢ã‹ã‚‰è¿½åŠ ã¾ã§

```python
@discord.app_commands.command(
    name="notebook_add",
    description="å˜èªå¸³ã«å˜èªã‚’è¿½åŠ "
)
@discord.app_commands.autocomplete(word=word_autocomplete)
async def notebook_add(
    self,
    interaction: discord.Interaction,
    notebook_name: str,
    word: str = None
) -> None:
    """å˜èªå¸³ã«å˜èªã‚’è¿½åŠ """
    user_id = str(interaction.user.id)
    
    # å˜èªãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã«èª˜å°
    if not word:
        await interaction.response.send_message(
            "ğŸ” è¿½åŠ ã™ã‚‹å˜èªã‚’æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚\n"
            "`/notebook_search query:å˜èª` ã§æ¤œç´¢ã§ãã¾ã™ã€‚",
            ephemeral=True
        )
        return
    
    db_manager = get_db_manager()
    async with db_manager.acquire() as conn:
        # å˜èªå¸³ã‚’å–å¾—
        notebook = await conn.fetchrow("""
            SELECT notebook_id FROM vocabulary_notebooks 
            WHERE user_id = $1 AND name = $2
        """, user_id, notebook_name)
        
        if not notebook:
            await interaction.response.send_message(
                f"âŒ å˜èªå¸³ã€Œ{notebook_name}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
                ephemeral=True
            )
            return
        
        # å˜èªã‚’æ¤œç´¢ï¼ˆå®Œå…¨ä¸€è‡´ã‚’å„ªå…ˆï¼‰
        word_row = await conn.fetchrow("""
            SELECT word_id, word, jp FROM words 
            WHERE word = $1
            LIMIT 1
        """, word)
        
        if not word_row:
            # å®Œå…¨ä¸€è‡´ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢
            candidates = await conn.fetch("""
                SELECT word_id, word, jp 
                FROM words 
                WHERE word ILIKE $1 || '%' OR jp ILIKE '%' || $1 || '%'
                ORDER BY 
                  CASE WHEN word = $1 THEN 1
                       WHEN word LIKE $1 || '%' THEN 2
                       ELSE 3 END
                LIMIT 10
            """, word)
            
            if not candidates:
                await interaction.response.send_message(
                    f"âŒ å˜èªã€Œ{word}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
                    ephemeral=True
                )
                return
            
            if len(candidates) == 1:
                # å€™è£œãŒ1ã¤ã ã‘ãªã‚‰è‡ªå‹•ã§è¿½åŠ 
                word_row = candidates[0]
            else:
                # è¤‡æ•°å€™è£œãŒã‚ã‚‹å ´åˆã¯é¸æŠã•ã›ã‚‹
                view = WordSelectView(candidates, notebook['notebook_id'])
                await interaction.response.send_message(
                    f"ğŸ” ã€Œ{word}ã€ã«ä¸€è‡´ã™ã‚‹å˜èªãŒè¤‡æ•°è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚",
                    view=view,
                    ephemeral=True
                )
                return
        
        # æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        existing = await conn.fetchrow("""
            SELECT * FROM notebook_words 
            WHERE notebook_id = $1 AND word_id = $2
        """, notebook['notebook_id'], word_row['word_id'])
        
        if existing:
            await interaction.response.send_message(
                f"âœ… å˜èªã€Œ{word_row['word']}ã€ã¯æ—¢ã«å˜èªå¸³ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚",
                ephemeral=True
            )
            return
        
        # è¿½åŠ 
        await conn.execute("""
            INSERT INTO notebook_words (notebook_id, word_id)
            VALUES ($1, $2)
        """, notebook['notebook_id'], word_row['word_id'])
    
    await interaction.response.send_message(
        f"âœ… å˜èªã€Œ{word_row['word']} ({word_row['jp']})ã€ã‚’ã€Œ{notebook_name}ã€ã«è¿½åŠ ã—ã¾ã—ãŸï¼",
        ephemeral=True
    )
```

---

## 2. ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ï¼ˆã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900ã€çš„ãªã‚‚ã®ï¼‰

### ğŸ’¡ ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã¨ã¯

ã‚·ã‚¹ãƒ†ãƒ ãŒå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æä¾›ã™ã‚‹æ¨™æº–çš„ãªå˜èªå¸³ã€‚ä¾‹:
- ã€ŒNGSL Level 1ã€ï¼ˆæœ€é »å‡ºèªï¼‰
- ã€ŒNGSL Level 2ã€
- ã€ŒNGSL Level 3ã€
- ã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900ã€ï¼ˆå¤§å­¦å—é¨“é »å‡ºèªï¼‰

**ç‰¹å¾´:**
- âœ… å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜å˜èªå¸³ã‚’åˆ©ç”¨ã§ãã‚‹
- âœ… ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãŒä½œæˆãƒ»ç®¡ç†
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œã“ã®å˜èªå¸³ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€ã ã‘ã§ä½¿ãˆã‚‹
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‰Šé™¤ã§ããªã„ãŒã€å­¦ç¿’ã¯è‡ªç”±ã«ã§ãã‚‹

---

### ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

```sql
-- å˜èªå¸³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ï¼‰
CREATE TABLE IF NOT EXISTS vocabulary_notebooks (
    notebook_id SERIAL PRIMARY KEY,
    user_id TEXT,  -- NULLã®å ´åˆã¯ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨
    name TEXT NOT NULL,
    description TEXT,
    is_auto BOOLEAN DEFAULT FALSE,
    auto_type TEXT,
    is_system BOOLEAN DEFAULT FALSE,  -- ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ã‹ã©ã†ã‹
    system_type TEXT,  -- 'ngsl_level1', 'ngsl_level2', 'target1900', etc.
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, name)  -- user_idãŒNULLã®å ´åˆã¯ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ã¨ã—ã¦ä¸€æ„
);

-- ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã®å˜èªï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…±é€šï¼‰
CREATE TABLE IF NOT EXISTS system_notebook_words (
    notebook_id INT NOT NULL REFERENCES vocabulary_notebooks(notebook_id) ON DELETE CASCADE,
    word_id INT NOT NULL REFERENCES words(word_id) ON DELETE CASCADE,
    order_index INT,  -- å­¦ç¿’é †åº
    added_at TIMESTAMPTZ DEFAULT NOW(),
    PRIMARY KEY(notebook_id, word_id)
);

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’ã€Œãƒ•ã‚©ãƒ­ãƒ¼ã€ã™ã‚‹ï¼ˆå€‹äººç”¨ã‚³ãƒ”ãƒ¼ï¼‰
CREATE TABLE IF NOT EXISTS user_notebook_subscriptions (
    user_id TEXT NOT NULL,
    notebook_id INT NOT NULL REFERENCES vocabulary_notebooks(notebook_id) ON DELETE CASCADE,
    subscribed_at TIMESTAMPTZ DEFAULT NOW(),
    PRIMARY KEY(user_id, notebook_id)
);
```

**è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ:**
- `user_id` ãŒ `NULL` = ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³
- `user_id` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ = ãƒ¦ãƒ¼ã‚¶ãƒ¼å€‹äººã®å˜èªå¸³
- ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã¯ `system_notebook_words` ã«å˜èªã‚’ä¿å­˜ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…±é€šï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œãƒ•ã‚©ãƒ­ãƒ¼ã€ã™ã‚‹ã¨ã€`user_notebook_subscriptions` ã«è¨˜éŒ²

---

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¾‹

```sql
-- ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã®ä½œæˆ
INSERT INTO vocabulary_notebooks (user_id, name, description, is_system, system_type)
VALUES (NULL, 'NGSL Level 1', 'NGSLæœ€é »å‡ºèªï¼ˆç´„1000èªï¼‰', TRUE, 'ngsl_level1');

INSERT INTO vocabulary_notebooks (user_id, name, description, is_system, system_type)
VALUES (NULL, 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900', 'å¤§å­¦å—é¨“é »å‡ºèª1900èª', TRUE, 'target1900');

-- ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã«å˜èªã‚’è¿½åŠ 
INSERT INTO system_notebook_words (notebook_id, word_id, order_index)
SELECT 1, word_id, row_number() OVER (ORDER BY level, word_id)
FROM words 
WHERE level = 1 
ORDER BY level, word_id
LIMIT 1000;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’ãƒ•ã‚©ãƒ­ãƒ¼
INSERT INTO user_notebook_subscriptions (user_id, notebook_id)
VALUES ('user123', 1);
```

---

### ğŸ¨ UI/UXè¨­è¨ˆ

#### ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã®ä¸€è¦§è¡¨ç¤º

```
ğŸ“š ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³

1. ğŸ“– NGSL Level 1 (1000èª) â­
   æœ€é »å‡ºèªã‚’åŠ¹ç‡çš„ã«å­¦ç¿’
   [ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹] [å­¦ç¿’ã™ã‚‹]

2. ğŸ“– NGSL Level 2 (1000èª)
   ä¸­ç´šè€…å‘ã‘ã®é‡è¦èª
   [ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹] [å­¦ç¿’ã™ã‚‹]

3. ğŸ“– ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900 (1900èª) â­
   å¤§å­¦å—é¨“é »å‡ºèª
   [ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹] [å­¦ç¿’ã™ã‚‹]
```

**è¡¨ç¤ºæ–¹æ³•:**
- ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã¯ `is_system = TRUE` ã§è­˜åˆ¥
- `user_id = NULL` ãªã®ã§ã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŒã˜ã‚‚ã®ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ã€Œãƒ•ã‚©ãƒ­ãƒ¼ã€ãƒœã‚¿ãƒ³ã§å€‹äººç”¨ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
- ã€Œå­¦ç¿’ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã§ãã®ã¾ã¾å­¦ç¿’å¯èƒ½

---

### ğŸ”„ ãƒ•ã‚©ãƒ­ãƒ¼æ©Ÿèƒ½ã®å®Ÿè£…

```python
@discord.app_commands.command(
    name="notebook_follow",
    description="ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹"
)
async def notebook_follow(
    self,
    interaction: discord.Interaction,
    notebook_name: str
) -> None:
    """ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’ãƒ•ã‚©ãƒ­ãƒ¼"""
    user_id = str(interaction.user.id)
    
    db_manager = get_db_manager()
    async with db_manager.acquire() as conn:
        # ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’å–å¾—
        system_notebook = await conn.fetchrow("""
            SELECT notebook_id, name, description 
            FROM vocabulary_notebooks 
            WHERE is_system = TRUE AND name = $1
        """, notebook_name)
        
        if not system_notebook:
            await interaction.response.send_message(
                f"âŒ ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã€Œ{notebook_name}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
                ephemeral=True
            )
            return
        
        # æ—¢ã«ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        existing = await conn.fetchrow("""
            SELECT * FROM user_notebook_subscriptions 
            WHERE user_id = $1 AND notebook_id = $2
        """, user_id, system_notebook['notebook_id'])
        
        if existing:
            await interaction.response.send_message(
                f"âœ… æ—¢ã«ã€Œ{notebook_name}ã€ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã¾ã™ã€‚",
                ephemeral=True
            )
            return
        
        # ãƒ•ã‚©ãƒ­ãƒ¼
        await conn.execute("""
            INSERT INTO user_notebook_subscriptions (user_id, notebook_id)
            VALUES ($1, $2)
        """, user_id, system_notebook['notebook_id'])
        
        # å˜èªæ•°ã‚’å–å¾—
        word_count = await conn.fetchval("""
            SELECT COUNT(*) FROM system_notebook_words 
            WHERE notebook_id = $1
        """, system_notebook['notebook_id'])
    
    await interaction.response.send_message(
        f"âœ… ã€Œ{notebook_name}ã€({word_count}èª) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ãŸï¼\n"
        f"ã“ã‚Œã§ã€Œ{notebook_name}ã€ã‹ã‚‰å­¦ç¿’ã§ãã¾ã™ã€‚",
        ephemeral=True
    )
```

---

### ğŸ“š ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‹ã‚‰å­¦ç¿’

```python
async def start_from_notebook(
    self,
    interaction: discord.Interaction,
    notebook_name: str
) -> None:
    """å˜èªå¸³ã‹ã‚‰å­¦ç¿’ã‚’é–‹å§‹ï¼ˆã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ã‚‚å«ã‚€ï¼‰"""
    user_id = str(interaction.user.id)
    
    await ensure_defer(interaction)
    
    db_manager = get_db_manager()
    async with db_manager.acquire() as conn:
        # å˜èªå¸³ã‚’å–å¾—ï¼ˆã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å€‹äººã®ã‚‚å«ã‚€ï¼‰
        notebook = await conn.fetchrow("""
            SELECT notebook_id, is_system, user_id 
            FROM vocabulary_notebooks 
            WHERE name = $1 
              AND (
                  is_system = TRUE 
                  OR user_id = $2
              )
        """, notebook_name, user_id)
        
        if not notebook:
            await interaction.followup.send(
                f"âŒ å˜èªå¸³ã€Œ{notebook_name}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚",
                ephemeral=True
            )
            return
        
        # ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ã®å ´åˆ
        if notebook['is_system']:
            words = await conn.fetch("""
                SELECT w.word_id, w.word, w.jp, w.pos, w.example_en, w.example_ja
                FROM system_notebook_words snw
                JOIN words w ON snw.word_id = w.word_id
                WHERE snw.notebook_id = $1
                ORDER BY snw.order_index, random()
                LIMIT 10
            """, notebook['notebook_id'])
        else:
            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å€‹äººã®å˜èªå¸³ã®å ´åˆ
            words = await conn.fetch("""
                SELECT w.word_id, w.word, w.jp, w.pos, w.example_en, w.example_ja
                FROM notebook_words nw
                JOIN words w ON nw.word_id = w.word_id
                WHERE nw.notebook_id = $1
                ORDER BY random()
                LIMIT 10
            """, notebook['notebook_id'])
        
        if not words or len(words) < 1:
            await interaction.followup.send(
                f"âŒ å˜èªå¸³ã€Œ{notebook_name}ã€ã«å˜èªãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
                ephemeral=True
            )
            return
    
    # æ—¢å­˜ã®å­¦ç¿’ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨
    items = [dict(r) for r in words]
    batch_id = str(uuid.uuid4())
    view = VocabSessionView(batch_id, items)
    await safe_edit(interaction, embed=discord.Embed(title=f"è‹±å˜èª 10å• - {notebook_name}"), view=None)
    await view.send_current(interaction)
    
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒƒãƒã‚’è¨˜éŒ²
    async with db_manager.acquire() as conn:
        await conn.execute(
            "INSERT INTO session_batches(user_id, module, batch_id) VALUES($1,$2,$3) ON CONFLICT DO NOTHING",
            user_id, "vocab", batch_id
        )
```

---

### ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã®ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```python
# scripts/create_system_notebooks.py

async def create_system_notebooks():
    """ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’ä½œæˆ"""
    db_manager = get_db_manager()
    await db_manager.initialize()
    
    async with db_manager.acquire() as conn:
        # NGSL Level 1ã‚’ä½œæˆ
        notebook_id = await conn.fetchval("""
            INSERT INTO vocabulary_notebooks (user_id, name, description, is_system, system_type)
            VALUES (NULL, 'NGSL Level 1', 'NGSLæœ€é »å‡ºèªï¼ˆç´„1000èªï¼‰', TRUE, 'ngsl_level1')
            RETURNING notebook_id
        """)
        
        # Level 1ã®å˜èªã‚’è¿½åŠ 
        await conn.execute("""
            INSERT INTO system_notebook_words (notebook_id, word_id, order_index)
            SELECT $1, word_id, row_number() OVER (ORDER BY level, word_id) as order_index
            FROM words 
            WHERE level = 1 
            ORDER BY level, word_id
            LIMIT 1000
        """, notebook_id)
        
        # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900ã‚’ä½œæˆï¼ˆä¾‹ï¼šlevel 1ã¨2ã‚’çµ„ã¿åˆã‚ã›ï¼‰
        notebook_id_target = await conn.fetchval("""
            INSERT INTO vocabulary_notebooks (user_id, name, description, is_system, system_type)
            VALUES (NULL, 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900', 'å¤§å­¦å—é¨“é »å‡ºèª1900èª', TRUE, 'target1900')
            RETURNING notebook_id
        """)
        
        await conn.execute("""
            INSERT INTO system_notebook_words (notebook_id, word_id, order_index)
            SELECT $1, word_id, row_number() OVER (ORDER BY level, word_id) as order_index
            FROM words 
            WHERE level IN (1, 2)
            ORDER BY level, word_id
            LIMIT 1900
        """, notebook_id_target)
    
    print("âœ… ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³ã‚’ä½œæˆã—ã¾ã—ãŸ")
```

---

## ğŸ“‹ ã¾ã¨ã‚

### å˜èªé¸æŠæ©Ÿèƒ½
1. **Autocomplete** ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢
2. **Select Menu** ã§å€™è£œã‹ã‚‰é¸æŠ
3. **éƒ¨åˆ†ä¸€è‡´æ¤œç´¢** ã§æŸ”è»Ÿã«æ¤œç´¢

### ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨å˜èªå¸³
1. **NGSL Level 1, 2, 3** ãªã©ã®æ¨™æº–çš„ãªå˜èªå¸³
2. **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ1900** ãªã©ã®å¤§å­¦å—é¨“å‘ã‘å˜èªå¸³
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œãƒ•ã‚©ãƒ­ãƒ¼ã€ã—ã¦åˆ©ç”¨
4. å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŒã˜å˜èªå¸³ã‚’æä¾›

ã“ã‚Œã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯åŠ¹ç‡çš„ã«å˜èªã‚’é¸ã¹ã€ã‚·ã‚¹ãƒ†ãƒ æ¨å¥¨ã®å˜èªå¸³ã‚‚æ´»ç”¨ã§ãã¾ã™ï¼
